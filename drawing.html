<html>

<head>
    <title>Pixel Drawing Version 0.3</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
</head>
    <script type="text/javascript">
    var canvas, canvasContext,mouseX = 0, mouseY = 0;
    var penColour = "#eeeeee";
    var lineWidth = 1;
    
    function init() {
        canvas = document.getElementById('drawingCanvas');
        canvas.addEventListener('contextmenu', function(e) {
            if (e.button == 2) {
            // Block right-click menu thru preventing default action.
            e.preventDefault();
            }
        });
        canvasContext = canvas.getContext("2d");
        canvasContext.globalAlpha = 1;
        w = canvas.width;
        h = canvas.height;

        canvasContext.fillStyle = penColour;
        canvasContext.strokeStyle = penColour;
        
        // Set up the bitmap drawing area with grid
        blank()
    
        canvas.addEventListener("mousedown", function (e) { mouseControl(e) }, false);

    }
    
    function changeColour(obj) {
        penColour = obj.id;
    
    }
    
    function blank()
    {

        canvasContext.clearRect(0, 0, w, h);
        document.getElementById("canvasBitmap").style.display = "none";

        for (x = 0; x <= w; x += 20) {
            canvasContext.moveTo(x, 0);
            canvasContext.lineTo(x, h);

            for (y = 0; y <= h; y += 20) {
                canvasContext.moveTo(0, y);
                canvasContext.lineTo(w, y);
            }
         }
         canvasContext.stroke();
         penColour = "#000";
    }
    
    function newDocument() {
        var m = confirm("Delete the whole drawing - Are you sure?");
        if (m) {
            blank();
        }
    }
    
    function saveDocument() {
        document.getElementById("canvasBitmap").style.border = "2px solid";
        var dataURL = canvas.toDataURL();
        document.getElementById("canvasBitmap").src = dataURL;
        document.getElementById("canvasBitmap").style.display = "inline";
    }
    
    function mouseControl(e) {
    

        console.log(e);

        // Get the mouse coords relative to canvas
        mouseX = parseInt((e.clientX - canvas.offsetLeft) / 20);
        mouseY = parseInt((e.clientY - canvas.offsetTop) / 20);


        // If using eraser then need to reapply the griidlines
        if (penColour == "white" || e.button == 2) 
        {
            canvasContext.lineWidth = 1;
            canvasContext.strokeStyle = "#eeeeee";
            canvasContext.fillStyle = "white";
            canvasContext.beginPath();
            canvasContext.fillRect((mouseX * 20), (mouseY * 20), 19, 19);
            canvasContext.strokeRect((mouseX * 20), (mouseY * 20), 20, 20);
            canvasContext.closePath();
        }
        else 
        {
            canvasContext.lineWidth = 1;
            canvasContext.strokeStyle = penColour;
            canvasContext.fillStyle = penColour;
            canvasContext.beginPath();
            canvasContext.fillRect((mouseX * 20), (mouseY * 20), 19, 19);
            canvasContext.closePath();
        }



        console.log(mouseX, mouseY);
  

    
    }
    </script>

    <body onload="init()">
        <div style="margin: auto; ">

            <div style="width: 400px; margin-right: 40px;border:2px solid; float: left;display:block;">
                <canvas id="drawingCanvas" width="400" height="400"></canvas>
            </div>
            
            <div style="width: 50%;  display:block; float: right; width: 100px; border: 1px solid black;"></div>
                <p style="font-family: arial;">Colour Palette</p>
            
                <div style="float: left; width:60px;height:60px;background:green;" id="green" onclick="changeColour(this)"></div>
                <div style="float: left; width:60px;height:60px;background:blue;" id="blue" onclick="changeColour(this)"></div>
                <div style="float: left; width:60px;height:60px;background:red;" id="red" onclick="changeColour(this)"></div>
                <div style="float: left; width:60px;height:60px;background:yellow;" id="yellow" onclick="changeColour(this)"></div>
                <div style="float: left; width:60px;height:60px;background:orange;" id="orange" onclick="changeColour(this)"></div>
                <div style="float: left; width:60px;height:60px;background:black;" id="black" onclick="changeColour(this)"></div>
                <span style="clear: right;overflow: auto;display: table;content: '';"><p>&nbsp;</p></span>
                <p style="font-family: arial;padding-top:80px">Eraser</p>
                <div style="float: left;width:60px;height:60px;background:white;border:2px solid;" id="white" onclick="changeColour(this)"></div>
                <span style="clear: right;overflow: auto;display: table;content: ''; height: 120px;"><p>&nbsp;</p></span>
                <input type="button" value="Save Drawing" id="btn" size="30" onclick="saveDocument()" style="">
                <input type="button" value="New Drawing" id="clr" size="23" onclick="newDocument()" style="">
            </div>
            <img id="canvasBitmap" style="position:absolute;top:10%;left:52%;" style="display:none;">

         </div>
    </body>
    </html>