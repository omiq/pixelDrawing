<html>

<head>
    <title>Pixel Drawing Version 1.0</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <script type="text/javascript" src="ntc.js"></script>

    <script type="text/javascript">
    var canvas, canvasContext,mouseX = 0, mouseY = 0;
    var penColour = "#eeeeee";
    var lineWidth = 1;
    
    function init() {
        canvas = document.getElementById('drawingCanvas');
        canvas.addEventListener('contextmenu', function(e) {
            if (e.button == 2) {
            // Block right-click menu thru preventing default action.
            e.preventDefault();
            }
        });
        canvasContext = canvas.getContext("2d");
        canvasContext.globalAlpha = 1;
        w = canvas.width;
        h = canvas.height;

        canvasContext.fillStyle = "white";
        canvasContext.strokeStyle = penColour;
        
        
        // Set up the bitmap drawing area with grid
        blank()
    
        canvas.addEventListener("mousedown", function (e) { mouseControl(e) }, false);

    }

    function intHex(rgb)
    {
        var hex = Number(rgb).toString(16);
        return hex.padStart(2, '0');
    }



    function rgbHex(r, g, b) {
        if (r > 255 || g > 255 || b > 255)
            throw "Invalid colour!";
        var hexString = intHex(r)+intHex(g)+intHex(b);
        return "#" + hexString;
    }
    
    function changeColour(obj) {
        penColour = obj.id;
    
    }
    
    function blank()
    {

        penColour = "#eeeeee";
        canvasContext.fillStyle = "#ffffff";
        canvasContext.strokeStyle = penColour;
        canvasContext.clearRect(0, 0, w, h);
        document.getElementById("canvasBitmap").style.display = "none";

        canvasContext.fillRect(0, 0, canvas.width, canvas.height);

        for (x = 0; x <= w; x += 20) {
            canvasContext.moveTo(x, 0);
            canvasContext.lineTo(x, h);

            for (y = 0; y <= h; y += 20) {
                canvasContext.moveTo(0, y);
                canvasContext.lineTo(w, y);
            }
         }
         canvasContext.stroke();
         document.getElementById("instructions").innerHTML = "<p>";
            document.getElementById("header").innerHTML = "<h1></h1>";
         penColour = "#000000";
    }
    
    function newDocument() {
        var m = confirm("Delete the whole drawing - Are you sure?");
        if (m) {
            blank();
        }
    }

    // setpixel
    function setPixel(x,y,c) 
    {
        var p=canvasContext.createImageData(5,5);
        p.data[0]=c.r;
        p.data[1]=c.g;
        p.data[2]=c.b;
        p.data[3]=c.a;
        canvasContext.putImageData(p,x,y);
    }

    
    // Create finished document
    function saveDocument() {
        document.getElementById("canvasBitmap").style.border = "2px solid";
        var dataURL = canvas.toDataURL();
        document.getElementById("canvasBitmap").src = dataURL;
        document.getElementById("canvasBitmap").style.display = "block";

        var instructions = {
            "Green": "",
            "Blue": "",
            "Red": "",
            "Yellow": "",
            "Orange": "",
            "Black": "",
            "Silver": "",
            "Grey": "",
            "Slate Grey": "",
            "Brown": "",
            "White": ""

        };
        var thisPixel
        
        // the colour to mark pixels as done
        mark = {
            r: 255,
            g: 100,
            b: 255,
            a: 255
        };

        // read the row and column colour values from the drawing
        for (row = 10; row < 400; row += 20)
        {

            for (col = 10; col < 400; col += 20)
            {
                var thisPixel = canvasContext.getImageData(col, row, 1, 1).data; 
                var n_match  = ntc.name(rgbHex(thisPixel[0], thisPixel[1], thisPixel[2]));
                var thisColourName = n_match[1];
                
                var columnLetter = String.fromCharCode(65+parseInt(col/20));
                var rowNumber = String(parseInt(row/20));
                instructions[thisColourName]+=columnLetter+rowNumber+" ";
                if(columnLetter+rowNumber=="A0") console.log(col,row);
                //setPixel(col, row, mark);
            }

        }

        document.getElementById("header").innerHTML = "<h1>Instructions</h1>";
   
        for (var item in instructions)
        {
           if(item != "White") document.getElementById("instructions").innerHTML += "<h3>"+item+"</h3>"+instructions[item]+"\n\n";
        }
    }    

    // mouse drawing routine
    function mouseControl(e) {
    

        //console.log(e);

        // Get the mouse coords relative to canvas
        mouseX = parseInt((e.clientX - canvas.offsetLeft) / 20);
        mouseY = parseInt((e.clientY - canvas.offsetTop) / 20);


        // If using eraser then need to reapply the griidlines
        if (penColour == "white" || e.button == 2) 
        {
            canvasContext.lineWidth = 1;
            canvasContext.strokeStyle = "#eeeeee";
            canvasContext.fillStyle = "white";
            canvasContext.beginPath();
            canvasContext.fillRect((mouseX * 20), (mouseY * 20), 19, 19);
            canvasContext.strokeRect((mouseX * 20), (mouseY * 20), 20, 20);
            canvasContext.closePath();
        }
        else 
        {
            canvasContext.lineWidth = 1;
            canvasContext.strokeStyle = penColour;
            canvasContext.fillStyle = penColour;
            canvasContext.beginPath();
            canvasContext.fillRect((mouseX * 20), (mouseY * 20), 19, 19);
            canvasContext.closePath();
        }

        //console.log(mouseX, mouseY);
  

    
    }
    </script>
</head>
    <body onload="init()">
        <div style="margin: auto; ">

            <div style="width: 400px; margin-right: 40px;border:2px solid #eeeeee; float: left;display:block; background-color: white;">
                <canvas id="drawingCanvas" width="400" height="400"></canvas>
            </div>
            
            <div style="width: 50%;  display:block; float: right; width: 100px;"></div>
                <p style="font-family: arial;">Colour Palette</p>
            
                <div style="float: left; width:60px;height:60px;background:green;" id="green" onclick="changeColour(this)"></div>
                <div style="float: left; width:60px;height:60px;background:blue;" id="blue" onclick="changeColour(this)"></div>
                <div style="float: left; width:60px;height:60px;background:red;" id="red" onclick="changeColour(this)"></div>
                <div style="float: left; width:60px;height:60px;background:yellow;" id="yellow" onclick="changeColour(this)"></div>
                <div style="float: left; width:60px;height:60px;background:orange;" id="orange" onclick="changeColour(this)"></div>
                <div style="float: left; width:60px;height:60px;background:black;" id="black" onclick="changeColour(this)"></div>
                <div style="float: left; width:60px;height:60px;background:silver;" id="silver" onclick="changeColour(this)"></div>
                <div style="float: left; width:60px;height:60px;background:darkgrey;" id="darkgrey" onclick="changeColour(this)"></div>
                <div style="float: left; width:60px;height:60px;background:darkslategray;" id="darkslategray" onclick="changeColour(this)"></div>
                <div style="float: left; width:60px;height:60px;background:saddlebrown;" id="saddlebrown" onclick="changeColour(this)"></div>

                <span style="clear: right;overflow: auto;display: table;content: '';"><p>&nbsp;</p></span>
                <p style="font-family: arial;padding-top:80px">Eraser</p>
                <div style="float: left;width:60px;height:60px;background:white;border:2px solid;" id="white" onclick="changeColour(this)"></div>
                <span style="clear: right;overflow: auto;display: table;content: ''; height: 120px;"><p>&nbsp;</p></span>
                <input type="button" value="Save Drawing" id="btn" size="30" onclick="saveDocument()" style="">
                <input type="button" value="New Drawing" id="clr" size="23" onclick="newDocument()" style="">
            </div>

            <div id="instructionsArea" style="clear: both;overflow: auto; ">
                <div id="header" style="color: black; font-family: Arial, Helvetica, sans-serif;"></div>
                <img id="canvasBitmap" style="display:none;">
                <div id="instructions" style="color: darkblue; font-family: Arial, Helvetica, sans-serif;">
                    &nbsp;
                </div>
            </div>
         </div>
    </body>
    </html>