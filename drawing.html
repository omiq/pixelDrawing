<html>

<head>
    <title>Pixel Drawing Version 1.8</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <script type="text/javascript" src="ntc.js"></script>

    <script type="text/javascript">
    var canvas, canvasContext,mouseX = 0, mouseY = 0;
    var penColour = "#eeeeee";
    var prevColour = penColour;
    var lineWidth = 1;
    var colourPalette = {
            "Red": "#ff0000",
            "DarkRed": "#AA0000",
            "LightPink": "#FFC0CB",
            "Orange": "	#ED9121",
            "Light Orange": "#FFCC00",
            "Orange Yellow": "#FFDD00",
            "Yellow": "#FFFF00",
            "Yellow Green": "#DDFF00",
            "Green": "#00FF00",
            "DarkGreen": "#004620",
            "Turquoise": "#40E0D0",
            "LightBlue": "#AAAAFF",
            "Blue": "#0000FF",
            "DarkBlue": "#0000AA",
            "Indigo": "#4B0082",
            "Purple": "#800080",
            "Magenta": "#FF00FF",
            "LightBrown": "#8B4513",
            "DarkBrown ": "#772211",
            "LightGray": "#AAAAAA",
            "DarkGray": "#DDDDDD",
            "Black": "#000000",
            "LightSkin": "#F5DEB3",
            "MediumSkin": "#DEB887"
        };



    function intHex(rgb)
    {
        var hex = Number(rgb).toString(16);
        return hex.padStart(2, '0');
    }



    function rgbHex(r, g, b) {
        if (r > 255 || g > 255 || b > 255)
            throw "Invalid colour!";
        var hexString = intHex(r)+intHex(g)+intHex(b);
        return "#" + hexString;
    }
    
    function changeColour(obj) {
        penColour = colourPalette[obj.id];
    
    }
    
    function blank()
    {



        var palette = document.getElementById("paletteButtons");
        palette.innerHTML="";

        for (var colourName in colourPalette)
        {
            var colourButton = '<div style="display:inline-block ;width:60px;height:60px;background:' + colourPalette[colourName] +';" id="' + colourName +'" onclick="changeColour(this)"></div>';
            palette.innerHTML+=colourButton;
        }

        penColour = "#eeeeee";
        canvasContext.fillStyle = "#ffffff";
        canvasContext.strokeStyle = penColour;
        canvasContext.clearRect(0, 0, w, h);
        document.getElementById("canvasBitmap").style.display = "none";

        canvasContext.fillRect(0, 0, canvas.width, canvas.height);

        for (x = 0; x <= w; x += 20) {
            canvasContext.moveTo(x, 0);
            canvasContext.lineTo(x, h);

            for (y = 0; y <= h; y += 20) {
                canvasContext.moveTo(0, y);
                canvasContext.lineTo(w, y);
            }
         }
         canvasContext.stroke();

         document.getElementById("instructions").innerHTML = "<p>";
            document.getElementById("header").innerHTML = "<h1></h1>";
         penColour = "#000000";
    }
    
    function newDocument() {
        var m = confirm("Delete the whole drawing - Are you sure?");
        if (m) {
            blank();
        }
    }

    // setpixel
    function setPixel(x,y,c) 
    {
        var p=canvasContext.createImageData(5,5);
        p.data[0]=c.r;
        p.data[1]=c.g;
        p.data[2]=c.b;
        p.data[3]=c.a;
        canvasContext.putImageData(p,x,y);
    }


    function getKeyByValue(object, value) { 
            for (var prop in object) { 
                if (object.hasOwnProperty(prop)) { 
                    if (object[prop] === value) 
                    return prop; 
                } 
            } 
        } 
      


        
const parseNumber = (num) => Number.parseInt(num.slice(1, num.length + 1));
const sorter = (first, second) => {
  if (first.slice(0, 1) < second.slice(0.1)) {
    return -1;
  } else if (first.slice(0, 1) === second.slice(0,1)) {
    if (parseNumber(first) < parseNumber(second)) {
      return -1;
    } else {
      return 1;
    }
  }
  else {
    return 1;
  }
}
const reducer = (acc, current) => {
  if (acc.length === 0) {
    acc.push(current);
    return acc;
  }
  const lastVal = acc[acc.length - 1]
  if (lastVal.includes('-')) {
    const range = lastVal.split('-');
    if (range[1].slice(0,1) === current.slice(0,1)) {
      if (parseNumber(range[1]) + 1 === parseNumber(current)) {
        range[1] = current;
        acc[acc.length -1] = range.join('-');
      } else {
        acc.push(current);
      }
    } else {
      acc.push(current);
    }
  } else {
    if (lastVal.slice(0, 1) === current.slice(0, 1)) {
      if (parseNumber(lastVal) + 1 === parseNumber(current)) {
        const range = [lastVal, current];
        acc[acc.length - 1] = range.join('-');
      } else {
        acc.push(current);
      }
    } else {
      acc.push(current);
    }
  }
  return acc;
}






    
    // Create finished document
    function saveDocument() {

        document.getElementById("instructions").innerHTML = "<p>";
            document.getElementById("header").innerHTML = "<h1></h1>";

        // initialize colours
        var instructions = { };

        document.getElementById("canvasBitmap").style.border = "2px solid";


        var resizedCanvas = document.getElementById("zoomcanvas");
        var resizedContext = resizedCanvas.getContext("2d");

        resizedCanvas.height = "900";
        resizedCanvas.width = "900";

        resizedContext.drawImage(canvas, 0, 0, resizedCanvas.width, resizedCanvas.height);
        var myResizedData = resizedCanvas.toDataURL();

        document.getElementById("canvasBitmap").src = myResizedData;
        document.getElementById("canvasBitmap").style.display = "block";

        var instructions = {       

        };
        var thisPixel
        
        // the colour to mark pixels as done
        mark = {
            r: 255,
            g: 100,
            b: 255,
            a: 255
        };

        // read the row and column colour values from the drawing
        for (row = 10; row < 400; row += 20)
        {

            for (col = 10; col < 400; col += 20)
            {
                var thisPixel = canvasContext.getImageData(col, row, 1, 1).data; 

                var n_match  = ntc.name(rgbHex(thisPixel[0], thisPixel[1], thisPixel[2]));
                var thisColourName = n_match[1]; 
                

                var columnLetter = String.fromCharCode(65+parseInt(col/20));
                var rowNumber = String(parseInt(row/20));
                var thisEntry = columnLetter+','+rowNumber+" ";
                instructions[thisColourName]+=thisEntry;

            }

        }

               
        // Document heading
        document.getElementById("header").innerHTML = "<h1>Instructions</h1>";

   



        // Instructions table
        for (var item in instructions)
        {
           if(item != "White") 
           {
               var outInstruction = [];
               var thisInstruction = instructions[item].replace("undefined","").trim();
               var breakUpInstruction = thisInstruction.split(' ');
               var previousLetter = '';
               var previousNumb = -1;
               var nextCellArray = [];
               
               for (var cell = 0; cell < breakUpInstruction.length; cell++)
               {
                   var cellArray = breakUpInstruction[cell].split(',');
                   
                   if (cell+1 < breakUpInstruction.length)
                   {
                        nextCellArray = breakUpInstruction[cell+1].split(',');
                   }
                   else
                   {
                    nextCellArray = [];
                   }
                   var cellLetter = cellArray[0];
                   var numb = cellArray[1];


                    // both different
                   if (cellLetter != previousLetter && numb != previousNumb)
                   {
                        if(outInstruction[outInstruction.length-1] == '-')
                        {
                            outInstruction.push(previousLetter + previousNumb);
                        }
                        else
                        {
                            outInstruction.push(cellLetter + numb);
                        }


                   }

                   // number different
                   if (cellLetter == previousLetter && numb != previousNumb)
                   {
                       if(outInstruction[outInstruction.length-1] != '-')
                       {
                           outInstruction.push('-');
                       }
                       else
                       {
                           if(nextCellArray[0] != cellLetter)
                           {
                                outInstruction.push(cellLetter + numb);
                           }
                       }


                   }

                   // Letter different
                   if (cellLetter != previousLetter && numb == previousNumb)
                   {
                       if(outInstruction[outInstruction.length-1] != '-')
                       {
                           outInstruction.push('-');
                       }
                       else
                       {
                        if(nextCellArray[1] != numb)
                           {
                                outInstruction.push(cellLetter + numb);
                           }
                       }


                   }



                previousLetter = cellLetter; 
                previousNumb = numb;


               }
               var htmlInstruction = outInstruction.join(' ').replace(/ - /gi,'-');
               document.getElementById("instructions").innerHTML += "<h3>"+item+"</h3>"+htmlInstruction+"\n\n";
               
           }
        }
    }    

    // mouse drawing routine
    function mouseControl(e, eventType) {
    
        // What type of mouse action is being taken?
        switch (eventType)
        {
            case "down":
                mouseControl.isDrawing = true;
                break;
            case "up":
                mouseControl.isDrawing = false;
                if (penColour == "white" && prevColour != penColour) penColour = prevColour;
                break;
            case "out":
                mouseControl.isDrawing = false; 
                break;
            case "over":
                mouseControl.isDrawing = false;    
                break;
        }


        // Get the mouse coords relative to canvas
        mouseX = parseInt((e.clientX - canvas.offsetLeft) / 20);
        mouseY = parseInt((e.clientY - canvas.offsetTop) / 20);


        if(mouseControl.isDrawing)
        {
            // If using eraser then need to reapply the griidlines
            if (penColour == "white" || e.button == 2) 
            {
                canvasContext.lineWidth = 1;
                canvasContext.strokeStyle = "#eeeeee";
                canvasContext.fillStyle = "white";
                canvasContext.beginPath();
                canvasContext.fillRect((mouseX * 20), (mouseY * 20), 19, 19);
                canvasContext.strokeRect((mouseX * 20), (mouseY * 20), 20, 20);
                canvasContext.closePath();
            }
            else 
            {
                canvasContext.lineWidth = 1;
                canvasContext.strokeStyle = penColour;
                canvasContext.fillStyle = penColour;
                canvasContext.beginPath();
                canvasContext.fillRect((mouseX * 20), (mouseY * 20), 19, 19);
                canvasContext.closePath();
            }

        }
  

    
    }



    
    function init() {
        mouseControl.isDrawing = false;
        canvas = document.getElementById('drawingCanvas');
        canvas.addEventListener('contextmenu', function(e) {
            if (e.button == 2) {
            // Block right-click menu thru preventing default action.
                e.preventDefault();
                mouseControl.isDrawing = true;
                prevColour = penColour;
                penColour = "white";
            }
        });
        canvasContext = canvas.getContext("2d");
        canvasContext.globalAlpha = 1;
        w = canvas.width;
        h = canvas.height;

        canvasContext.fillStyle = "white";
        canvasContext.strokeStyle = penColour;
        
        
        // Set up the bitmap drawing area with grid
        blank()
    
        canvas.addEventListener("mousedown", function (e) { mouseControl(e,"down") }, false);
        canvas.addEventListener("mousemove", function (e) { mouseControl(e,"move") }, false);
        canvas.addEventListener("mouseup", function (e) { mouseControl(e,"up") }, false);
        canvas.addEventListener("mouseout", function (e) { mouseControl(e,"out") }, false);
        canvas.addEventListener("mouseover", function (e) { mouseControl(e,"over") }, false);
        
    }

    </script>
</head>
    <body onload="init()">
        <div style="margin: auto; ">

            <div style="width: 400px; margin-right: 40px;border:2px solid #eeeeee; float: left;display:block; background-color: white;">
                <canvas id="drawingCanvas" width="400" height="400"></canvas>
                <canvas id="zoomcanvas" width="900" height="900" style="visibility: hidden;display:none;"></canvas>
            </div>
            
            <div style="width: 50%;  display:block; float: right; width: 100px;"></div>
                
                
                <div id="palette" style="min-width:200px;max-width:1000px;display:block;">
                    <p style="font-family: arial;">Eraser</p>
                    <div style="display:inline-block ;width:60px;height:60px;background:white;border:2px solid black;" id="white" onclick="changeColour(this)"></div>
                    <p style="font-family: arial;">Colour Palette</p>
                    <div id="paletteButtons"></div>
                </div>

                <div id="buttons" style="min-width:200px;max-width:400px;display:block;">
                <span style="clear: right;overflow: auto;display: table;content: ''; height: 120px;"><p>&nbsp;</p></span>
                    <input type="button" value="Save Drawing" id="btn" size="30" onclick="saveDocument()" style="">
                    <input type="button" value="New Drawing" id="clr" size="23" onclick="newDocument()" style="">
                </div>
            </div>

            <div id="instructionsArea" style="clear: both;overflow: auto; ">
                <div id="header" style="color: black; font-family: Arial, Helvetica, sans-serif;"></div>
                <img id="canvasBitmap" style="display:none;">
                <div id="instructions" style="color: darkblue; font-family: Arial, Helvetica, sans-serif;">
                    &nbsp;
                </div>
            </div>
         </div>
    </body>
    </html>